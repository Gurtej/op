# HookflashServices
#

if [ -z "$(PREFIX)" ]; then PREFIX=/usr; fi


LIB_NAME=hookflash_services
ARNAME=lib$(LIB_NAME).a

CC=g++
CFLAGS=-fPIC
LDFLAGS=-D_LINUX
INC=-I../../../ -I$(PREFIX)/include
SRC=../../../hookflash/services/cpp
SRC_HTTP=../../../hookflash/services/http/cpp


OUT_DIR=out
OUT_BIN_DIR=$(OUT_DIR)/bin
OUT_OBJ_DIR=$(OUT_DIR)/obj
OUT_LIB_DIR=$(OUT_DIR)/lib
OUT_INCLUDE_DIR=$(OUT_DIR)/include


OBJS=$(patsubst $(SRC)/%.cpp,%.o,$(wildcard $(SRC)/*.cpp))
OBJS_HTTP=$(patsubst $(SRC_HTTP)/%.cpp,%.o,$(wildcard $(SRC_HTTP)/*.cpp))

OBJ_PATHS=$(addprefix $(OUT_OBJ_DIR)/,$(OBJS))
OBJ_PATHS_HTTP=$(addprefix $(OUT_OBJ_DIR)/,$(OBJS_HTTP))


all:prepare copy_headers build

copy_headers:
	cp ../../../hookflash/services/*.h $(OUT_INCLUDE_DIR)/hookflash/services
	cp ../../../hookflash/services/internal/*.h $(OUT_INCLUDE_DIR)/hookflash/services/internal

build: $(OBJS) archive

%.o: $(SRC)/%.cpp
	$(CC) $(INC) $(LDFLAGS) $(CFLAGS) -c -o $(OUT_OBJ_DIR)/$@ $<

archive:
	ar rcs $(OUT_LIB_DIR)/$(ARNAME) $(OBJ_PATHS) $(OBJ_PATHS_HTTP)


prepare:
	mkdir -p $(OUT_OBJ_DIR)
	mkdir -p $(OUT_LIB_DIR)
	mkdir -p $(OUT_INCLUDE_DIR)/hookflash/services/internal

install:
	mkdir -p $(PREFIX)
	cp -R $(OUT_INCLUDE_DIR) $(PREFIX)
	cp -R $(OUT_LIB_DIR) $(PREFIX)
	#cp -R $(OUT_BIN_DIR) $(PREFIX)

